##11/21/22
##Team Purple
##Task Management System Main App Page

##Updates:
##Abel's current version of Main Page
##Gets the user's attributes after running the login page
##working calendar
##working search function(template)

##import Add
##import Remove
##import Settings
import calendar
import datetime
from tkinter.ttk import Combobox
from tkinter import *
#from tkinter.ttk import Combobox
import TMSTaskClass as TC ##my current name for class file
from tkinter import messagebox
import csv

TASKFILE = "taskList.csv"

def printToTextBox():
    tasksTextBox.insert(END, "Yippee!\n")

def searchFunc(criteria, tasksTextBox, details):
    '''this function will display tasks
    to the Task List text box on the main page'''
    tasksTextBox.delete(1.0,END)
    index = 0
    match criteria:
        case "Date": index=1
        case "Time": index=2
        case "Title": index=3
        case "Duration": index=4
        case "Description": index=5
        
        ##open the CSV file in read mode
    with open(TASKFILE, 'r') as file:
        csvReader=csv.reader(file)
        ##iterate through csv
        for member in csvReader:
        ##if thing in that index of the row == details:
            if member[index] == details:
            ##display result to the task list text box on main page
                tasksTextBox.insert(END, "Yippee!\n")


def searchByResponse(sF, criteria, tasksTextBox):
    ##sF = searchFrame2
    ##criteria = retult of search combobox
    ##details is what was written in the entry
    widget_list = all_children(sF)
    for item in widget_list:
        item.destroy() ##destroys each widget in frame to be replaced later
        
    t="" 
    match criteria:
        case "Date":
            t="Enter a Date (format: yyyy/mm/dd):"
        case "Time":
            t="Enter a Time (military time, format: 00:00):"
        case "Title":
            t="Enter Task Title:"
        case "Duration":
            t="Enter Duration (hours): "
        case "Description":
            t="Enter Task Description: "
        case "No Criteria":
            t ='''Choose Criteria above and
press 'Go' to confirm selection.
Then, type details in the entry
box on the right.'''
         
    searchLabel2=Label(sF, text=t, bg="Green", fg='white', font=("Comic Sans MS", 11))
    searchLabel2.pack(side=LEFT)

    
    searchEntry = Entry(sF)
    searchButton=Button(sF, text="Search", command=lambda:searchFunc(criteria, tasksTextBox, searchEntry.get()))
    
    searchButton.pack(side=RIGHT)
    searchEntry.pack(side=RIGHT, padx=5)

    

def all_children(frame):
    ##this function references all widgets in a frame
    ##and returns it as a list
    ##made to be recursive so another function
    ##can iterate through and destory all widgets but not the entire frame
    _list = frame.winfo_children() ##list of cF's widgets from bottom to top
    for widget in _list:
        if widget.winfo_children():
            _list.extend(window.winfo_children())

    return _list


def responsiveCalendar(window, user, yC, monthsList, mC, cF):
    widget_list = all_children(cF)
    for item in widget_list:
        item.destroy() ##destroys each widget in frame 
    m=monthsList.index(mC)+1
    today = datetime.date.today()
    dayNum=0
    x = calendar.monthrange(int(yC), m)
    daysInMonth = x[1]
    k=(datetime.date(int(yC), m, 1)).weekday() ##the first day of the chosen month of chosen year
    count = 0
    
    ##Calendar frame and days of the week labels
    days = ["Mon", "Tue","Wed","Thu","Fri","Sat", "Sun"]
    dateToday = datetime.date.today()
    ##creates a label for each weekday 0-6 starting with monday (0)
    for d in range(len(days)):
        weekdayLabel = Label(cF, text=days[d], bg='green', fg='white', font=("Comic Sans MS", 12))
        weekdayLabel.grid(column=d, row=0)
        
            
    ##Creates a button for each day
    ##when clicked, the current tasks will appear
    ##or a message saying there are no tasks for that day
    
    for i in range(6):
        for j in range(7):
            
            if dayNum < daysInMonth:
                if count<k: ##creates a label for as many days before first day of month
                    label= Label(cF, text="   ", bg='green')
                    label.grid(row=i+1, column=j, sticky='nsew')
                    count+=1
                else:
                    dayNum+=1
                    if today.day == dayNum and today.month == m and str(today.year)==yC:
                        button = Button(cF, text=f"{dayNum}", fg="red")#, command=)
                        button.grid(row=i+1, column=j, sticky='nsew')
                    else:
                        button = Button(cF, text=f"{dayNum}")
                        button.grid(row=i+1, column=j, sticky='nsew')
    cF.pack(side=TOP)
            
               

def mainFunc(user):
    window = Tk()

    window.title('Task Management System')
    window.geometry('600x600')
    window.configure(bg='green')

    BG_COLOR = "Green"
    FG_COLOR = "White"

    ##Welcome Banner
    welcFrame = Frame(master=window)
    welcomeBanner = Label(welcFrame, text=(user[0]+"'s Calendar"),
                          bg='green', fg='white', font = ("Comic Sans MS",20))
    welcomeBanner.pack(side=LEFT)
    welcFrame.pack()


    ##Months and Years as combo boxes + go button
    dateFrame = Frame(master=window, bg='green')

    monthsList = ["January", "February", "March", "April",
                      "May", "June", "July", "August",
                      "September","October","November","December"]
    
    monthsCombo = Combobox(dateFrame,width=10,state="readonly")
    monthsCombo['values']= (monthsList)
    monthsCombo.current((datetime.date.today().month)-1)
    monthsCombo.pack(side=LEFT)


    yearsList = ["2022", "2023", "2024", "2025",
                      "2026", "2027", "2028", "2029",
                      "2030","2031","2032","2033"]
    
    yearsCombo = Combobox(dateFrame,width=6,state="readonly")
    yearsCombo['values']= (yearsList)
    yearsCombo.current((datetime.date.today().year)-2022)
    yearsCombo.pack(side=LEFT, pady=10)
    
    
    calendarFrame=Frame(master=window, bg="Green")
    showCalendarButton = Button(dateFrame, text="Show Calendar",
                         command=lambda:responsiveCalendar(window, user, yearsCombo.get(), monthsList, monthsCombo.get(), calendarFrame))
    showCalendarButton.pack(side=LEFT, padx=5)
        
    dateFrame.pack()
    responsiveCalendar(window, user, yearsCombo.get(), monthsList, monthsCombo.get(), calendarFrame)

    ##Frame for task related options
    ##including task list,
    ##task options (add, edit, remove)

    taskFrame = Frame(master=window, bg= 'green')
    taskLabelFrame = LabelFrame(taskFrame, text='Current Tasks', bg="Green", fg='white', font = ("Comic Sans MS",12))


    ##if tasks exist for that day. else, label says: "There are no tasks scheduled for this day"
    tasksTextBox = Text(taskLabelFrame, width = 20, height=10)#, state='disabled')
    tasksTextBox.pack(side=BOTTOM)
    taskLabelFrame.pack(side=LEFT,padx=70)


    addButton = Button(taskFrame, text="Add New Task")#, command=Add.AddFunc)##default to selected day
    editButton = Button(taskFrame, text="Edit Selected Task") ##if not selected, "please select a task"
    removeButton = Button(taskFrame, text="Remove Selected Task")##same as above and also "Are you sure?"
    addButton.pack(pady=5)
    editButton.pack(pady=5)
    removeButton.pack(pady=5)

    settingsButton=Button(taskFrame, text="User Settings")
    settingsButton.pack(pady=5)

    ##Frame for search function
    searchFrame1 = Frame(master=window, bg="Green")
    searchLabel1=Label(searchFrame1, text="Search by:", bg="Green", fg='white', font=("Comic Sans MS", 13))
    searchLabel1.pack(side=LEFT)

    searchByCombo = Combobox(searchFrame1, width=12, state="readonly")
    searchByCombo['values']= ("No Criteria", "Date", "Time",
                      "Title", "Duration", "Description")
    searchByCombo.set("No Criteria Set")
    searchByCombo.current(0)

    searchFrame2 = Frame(master=window, bg="Green")
    searchByResponse(searchFrame2, searchByCombo.get(), tasksTextBox)
    goButtonSearch = Button(searchFrame1, text="Go",
                            command=lambda:searchByResponse(searchFrame2, searchByCombo.get(), tasksTextBox))

    searchByCombo.pack(side=LEFT, pady=10)
    goButtonSearch.pack(side=LEFT, padx=5)


    searchFrame1.pack(side=TOP)
    searchFrame2.pack(side=TOP)
    taskFrame.pack(side=TOP, pady=10)

    window.mainloop()

mainFunc(['User'])
